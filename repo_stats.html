<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Repo Stats Report</title>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #111827;
      --panel2: #0f172a;
      --text: #d6deeb;
      --muted: #9ca3af;
      --grid: rgba(255,255,255,0.08);
      --accent: #60a5fa;
      --good: #34d399;
      --warn: #fbbf24;
      --bad: #fb7185;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--text); }
    header { padding: 18px 18px 10px; border-bottom: 1px solid var(--grid); }
    header h1 { margin: 0; font-size: 18px; }
    header .sub { margin-top: 6px; color: var(--muted); font-size: 12px; }

    .wrap { display: grid; grid-template-columns: 1fr; gap: 12px; padding: 14px; max-width: 1400px; margin: 0 auto; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

    .card { background: linear-gradient(180deg, var(--panel), var(--panel2)); border: 1px solid var(--grid); border-radius: 14px; padding: 12px; }
    .card h2 { margin: 0 0 8px; font-size: 14px; }
    .muted { color: var(--muted); font-size: 12px; }
    .big { font-size: 22px; font-weight: 700; }
    .kpi { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .pill { display: inline-block; padding: 2px 8px; border: 1px solid var(--grid); border-radius: 999px; font-size: 12px; color: var(--muted); }

    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    th, td { padding: 8px; border-bottom: 1px solid var(--grid); vertical-align: top; }
    th { text-align: left; color: var(--muted); position: sticky; top: 0; background: rgba(11,15,20,0.9); backdrop-filter: blur(6px); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .right { text-align: right; }
    .chartwrap { width: 100%; overflow: hidden; }
    .row { display: flex; justify-content: space-between; gap: 10px; align-items: baseline; }
    .note { color: var(--muted); font-size: 12px; margin-top: 6px; }
    .tiny { color: var(--muted); font-size: 11px; }
    .legend { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 10px; }
    .legitem { display: flex; gap: 8px; align-items: center; font-size: 12px; color: var(--muted); }
    .sw { width: 10px; height: 10px; border-radius: 3px; display: inline-block; }
    .search { display: flex; gap: 8px; }
    .search input { width: 100%; padding: 8px 10px; border-radius: 10px; border: 1px solid var(--grid); background: rgba(255,255,255,0.03); color: var(--text); }
    .btn { padding: 8px 10px; border-radius: 10px; border: 1px solid var(--grid); background: rgba(255,255,255,0.06); color: var(--text); cursor: pointer; }
  </style>
</head>
<body>
<header>
  <h1>Repo Stats Report</h1>
  <div class="sub">Root: <span class="mono">C:\Users\clash\OneDrive\Desktop\Codes\C\Chess\ChessGameC</span> • Generated: 2026-01-18 21:30:30</div>
</header>

<div class="wrap">

  <div class="grid3">
    <div class="card">
      <div class="row"><h2>Files</h2><span class="pill">.gitignore respected</span></div>
      <div class="big">975</div>
      <div class="note">Counted files = tracked + untracked (excluding ignored), via <span class="mono">git ls-files -co --exclude-standard</span>.</div>
    </div>
    <div class="card">
      <div class="row"><h2>Total size</h2><span class="pill">bytes on disk</span></div>
      <div class="big">84.54 MB</div>
      <div class="note">Sum of file sizes for included files.</div>
    </div>
    <div class="card">
      <div class="row"><h2>Total lines</h2><span class="pill">text-ish</span></div>
      <div class="big">5204957</div>
      <div class="note">Lines counted as UTF-8 with replacement for non-text bytes.</div>
    </div>
  </div>

  <div class="grid2">
    <div class="card">
      <div class="row">
        <h2>Top files by size</h2>
        <span class="pill">Top 30</span>
      </div>
      <div class="chartwrap" id="chart_top_size"></div>
      <div class="note">Hover on bars for exact numbers.</div>
    </div>
    <div class="card">
      <div class="row">
        <h2>Top files by lines</h2>
        <span class="pill">Top 30</span>
      </div>
      <div class="chartwrap" id="chart_top_lines"></div>
      <div class="note">Line counts are approximate for binary-heavy files (decoded with replacement).</div>
    </div>
  </div>

  <div class="grid2">
    <div class="card">
      <div class="row"><h2>Extension breakdown by size</h2><span class="pill">pie</span></div>
      <div class="chartwrap" id="pie_ext_bytes"></div>
      <div class="legend" id="leg_ext_bytes"></div>
    </div>
    <div class="card">
      <div class="row"><h2>Extension breakdown by lines</h2><span class="pill">pie</span></div>
      <div class="chartwrap" id="pie_ext_lines"></div>
      <div class="legend" id="leg_ext_lines"></div>
    </div>
  </div>

  <div class="grid2">
    <div class="card">
      <div class="row"><h2>Top extensions by size</h2><span class="pill">bar</span></div>
      <div class="chartwrap" id="bar_ext_bytes"></div>
    </div>
    <div class="card">
      <div class="row"><h2>Top extensions by lines</h2><span class="pill">bar</span></div>
      <div class="chartwrap" id="bar_ext_lines"></div>
    </div>
  </div>

  <div class="card">
    <div class="row">
      <h2>Tables</h2>
      <div class="search">
        <input id="q" placeholder="Filter by filename substring (e.g. ai_controller.c)"/>
        <button class="btn" onclick="applyFilter()">Filter</button>
        <button class="btn" onclick="clearFilter()">Clear</button>
      </div>
    </div>
    <div class="tiny">Tip: Click table headers to sort. (Sorting is basic but useful.)</div>

    <div style="height:12px"></div>

    <h2 style="margin-top:0">Top files (size)</h2>
    <div id="tbl_top_size"></div>

    <div style="height:16px"></div>

    <h2 style="margin-top:0">Top files (lines)</h2>
    <div id="tbl_top_lines"></div>

    <div style="height:16px"></div>

    <h2 style="margin-top:0">Extensions</h2>
    <div id="tbl_ext"></div>
  </div>

</div>

<script>
const DATA = {"top_files_by_size": [{"relpath": "src/nn-1c0000000000.nnue", "size_bytes": 74874478, "lines": 4766129, "blank_lines": 376674}, {"relpath": "gui/miniaudio.h", "size_bytes": 4195141, "lines": 95649, "blank_lines": 13821}, {"relpath": "src/nn-37f18f62d772.nnue", "size_bytes": 3519630, "lines": 220100, "blank_lines": 18589}, {"relpath": "assets/images/icon/icon.png", "size_bytes": 439009, "lines": 12702, "blank_lines": 386}, {"relpath": "installer/lib/miniz.c", "size_bytes": 357811, "lines": 7914, "blank_lines": 1128}, {"relpath": "html_pages/calls.html", "size_bytes": 241782, "lines": 213, "blank_lines": 23}, {"relpath": "assets/images/icon/icon2.ico", "size_bytes": 168400, "lines": 297, "blank_lines": 25}, {"relpath": "gui/info_panel.c", "size_bytes": 121750, "lines": 2720, "blank_lines": 495}, {"relpath": "assets/images/icon/icon.ico", "size_bytes": 102353, "lines": 2921, "blank_lines": 79}, {"relpath": "src/search.cpp", "size_bytes": 90895, "lines": 2220, "blank_lines": 437}, {"relpath": "gui/main.c", "size_bytes": 80891, "lines": 1887, "blank_lines": 325}, {"relpath": "assets/images/piece/enpassant/TravellerStandard-Regular.ttf", "size_bytes": 80364, "lines": 1729, "blank_lines": 181}, {"relpath": "gui/board_widget.c", "size_bytes": 76475, "lines": 1859, "blank_lines": 271}, {"relpath": "installer/lib/miniz.h", "size_bytes": 75278, "lines": 1424, "blank_lines": 272}, {"relpath": "gui/config_manager.c", "size_bytes": 68721, "lines": 1560, "blank_lines": 203}, {"relpath": "assets/images/icon/icon1.ico", "size_bytes": 67646, "lines": 91, "blank_lines": 18}, {"relpath": "src/syzygy/tbprobe.cpp", "size_bytes": 67016, "lines": 1765, "blank_lines": 337}, {"relpath": "assets/images/icon/icon3.ico", "size_bytes": 57793, "lines": 1522, "blank_lines": 32}, {"relpath": "assets/images/piece/enpassant/ChessUtrecht-Regular.ttf", "size_bytes": 56832, "lines": 4414, "blank_lines": 689}, {"relpath": "gui/replay_controller.c", "size_bytes": 55522, "lines": 1354, "blank_lines": 250}, {"relpath": "game/gamelogic.c", "size_bytes": 52181, "lines": 1543, "blank_lines": 232}, {"relpath": "gui/ai_dialog.c", "size_bytes": 51629, "lines": 1165, "blank_lines": 197}, {"relpath": "src/numa.h", "size_bytes": 50733, "lines": 1346, "blank_lines": 266}, {"relpath": "gui/theme_manager.c", "size_bytes": 48371, "lines": 992, "blank_lines": 111}, {"relpath": "gui/piece_theme_dialog.c", "size_bytes": 48028, "lines": 1075, "blank_lines": 157}, {"relpath": "src/position.cpp", "size_bytes": 45070, "lines": 1318, "blank_lines": 310}, {"relpath": "assets/images/system/preferences-desktop-theme-symbolic.svg", "size_bytes": 44936, "lines": 109, "blank_lines": 0}, {"relpath": "assets/images/piece/enpassant/AVENFONT.TTF", "size_bytes": 44448, "lines": 1810, "blank_lines": 589}, {"relpath": "gui/right_side_panel.c", "size_bytes": 43446, "lines": 1020, "blank_lines": 187}, {"relpath": "gui/app_theme_dialog.c", "size_bytes": 43135, "lines": 978, "blank_lines": 177}], "top_files_by_lines": [{"relpath": "src/nn-1c0000000000.nnue", "size_bytes": 74874478, "lines": 4766129, "blank_lines": 376674}, {"relpath": "src/nn-37f18f62d772.nnue", "size_bytes": 3519630, "lines": 220100, "blank_lines": 18589}, {"relpath": "gui/miniaudio.h", "size_bytes": 4195141, "lines": 95649, "blank_lines": 13821}, {"relpath": "assets/images/icon/icon.png", "size_bytes": 439009, "lines": 12702, "blank_lines": 386}, {"relpath": "installer/lib/miniz.c", "size_bytes": 357811, "lines": 7914, "blank_lines": 1128}, {"relpath": "assets/images/piece/enpassant/ChessUtrecht-Regular.ttf", "size_bytes": 56832, "lines": 4414, "blank_lines": 689}, {"relpath": "assets/images/icon/icon.ico", "size_bytes": 102353, "lines": 2921, "blank_lines": 79}, {"relpath": "assets/images/piece/enpassant/Smart-Regular.ttf", "size_bytes": 34720, "lines": 2909, "blank_lines": 822}, {"relpath": "gui/info_panel.c", "size_bytes": 121750, "lines": 2720, "blank_lines": 495}, {"relpath": "assets/images/piece/enpassant/CHEQ_TT.TTF", "size_bytes": 28580, "lines": 2709, "blank_lines": 1827}, {"relpath": "src/search.cpp", "size_bytes": 90895, "lines": 2220, "blank_lines": 437}, {"relpath": "assets/images/piece/enpassant/Chess-Regular.ttf", "size_bytes": 33440, "lines": 2216, "blank_lines": 559}, {"relpath": "assets/images/piece/enpassant/LUCEFONT.TTF", "size_bytes": 41360, "lines": 1887, "blank_lines": 608}, {"relpath": "gui/main.c", "size_bytes": 80891, "lines": 1887, "blank_lines": 325}, {"relpath": "assets/images/piece/enpassant/CASEFONT.TTF", "size_bytes": 35476, "lines": 1862, "blank_lines": 625}, {"relpath": "gui/board_widget.c", "size_bytes": 76475, "lines": 1859, "blank_lines": 271}, {"relpath": "assets/images/piece/enpassant/AVENFONT.TTF", "size_bytes": 44448, "lines": 1810, "blank_lines": 589}, {"relpath": "src/syzygy/tbprobe.cpp", "size_bytes": 67016, "lines": 1765, "blank_lines": 337}, {"relpath": "assets/images/piece/enpassant/TravellerStandard-Regular.ttf", "size_bytes": 80364, "lines": 1729, "blank_lines": 181}, {"relpath": "gui/config_manager.c", "size_bytes": 68721, "lines": 1560, "blank_lines": 203}, {"relpath": "game/gamelogic.c", "size_bytes": 52181, "lines": 1543, "blank_lines": 232}, {"relpath": "assets/images/icon/icon3.ico", "size_bytes": 57793, "lines": 1522, "blank_lines": 32}, {"relpath": "installer/lib/miniz.h", "size_bytes": 75278, "lines": 1424, "blank_lines": 272}, {"relpath": "gui/replay_controller.c", "size_bytes": 55522, "lines": 1354, "blank_lines": 250}, {"relpath": "src/numa.h", "size_bytes": 50733, "lines": 1346, "blank_lines": 266}, {"relpath": "src/position.cpp", "size_bytes": 45070, "lines": 1318, "blank_lines": 310}, {"relpath": "assets/images/piece/enpassant/ChessAlfonso-X.ttf", "size_bytes": 35852, "lines": 1292, "blank_lines": 204}, {"relpath": "gui/ai_dialog.c", "size_bytes": 51629, "lines": 1165, "blank_lines": 197}, {"relpath": "src/Makefile", "size_bytes": 32058, "lines": 1123, "blank_lines": 142}, {"relpath": "gui/piece_theme_dialog.c", "size_bytes": 48028, "lines": 1075, "blank_lines": 157}], "ext_rows": [{"ext": ".nnue", "files": 2, "bytes": 78394108, "lines": 4986229}, {"ext": ".h", "files": 78, "bytes": 4638039, "lines": 107589}, {"ext": ".c", "files": 47, "bytes": 1471647, "lines": 35431}, {"ext": ".svg", "files": 471, "bytes": 1403041, "lines": 3101}, {"ext": ".png", "files": 276, "bytes": 632399, "lines": 18491}, {"ext": ".ttf", "files": 11, "bytes": 456136, "lines": 22501}, {"ext": ".ico", "files": 5, "bytes": 433488, "lines": 5835}, {"ext": ".cpp", "files": 25, "bytes": 433107, "lines": 11691}, {"ext": ".html", "files": 7, "bytes": 373743, "lines": 2615}, {"ext": ".webp", "files": 12, "bytes": 123546, "lines": 3371}, {"ext": ".mp3", "files": 16, "bytes": 100503, "lines": 2708}, {"ext": ".py", "files": 5, "bytes": 73392, "lines": 2173}, {"ext": "(noext)", "files": 6, "bytes": 65755, "lines": 1897}, {"ext": ".xml", "files": 1, "bytes": 29372, "lines": 551}, {"ext": ".md", "files": 2, "bytes": 12469, "lines": 598}, {"ext": ".sh", "files": 1, "bytes": 2373, "lines": 94}, {"ext": ".txt", "files": 5, "bytes": 1207, "lines": 11}, {"ext": ".manifest", "files": 1, "bytes": 1115, "lines": 34}, {"ext": ".rc", "files": 3, "bytes": 943, "lines": 27}, {"ext": ".theme", "files": 1, "bytes": 133, "lines": 10}]};

function fmtBytes(n){
  const u = ["B","KB","MB","GB","TB"];
  let x = n;
  let i = 0;
  while (x >= 1024 && i < u.length-1) { x /= 1024; i++; }
  return (i===0 ? String(Math.round(x)) : x.toFixed(2)) + " " + u[i];
}

function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

function colorFor(i){
  // deterministic palette, no external libs
  const pal = ["#60a5fa","#34d399","#fbbf24","#fb7185","#a78bfa","#22d3ee","#f472b6","#c084fc","#fde047","#4ade80"];
  return pal[i % pal.length];
}

function svgBarChart(opts){
  const {title, items, valueKey, labelKey, height=320, valueFmt=(x)=>String(x)} = opts;
  const w = 860;
  const padL = 220, padR = 20, padT = 24, padB = 28;
  const h = height;
  const innerW = w - padL - padR;
  const innerH = h - padT - padB;

  const maxV = Math.max(1, ...items.map(it => it[valueKey]));
  const barH = innerH / Math.max(1, items.length);
  const gap = clamp(barH * 0.18, 2, 8);
  const actualBarH = barH - gap;

  let svg = `<svg viewBox="0 0 ${w} ${h}" width="100%" height="${h}" role="img" aria-label="${title}">
    <rect x="0" y="0" width="${w}" height="${h}" fill="transparent"/>
    <g transform="translate(${padL},${padT})">`;

  // grid + axis labels
  const ticks = 5;
  for (let i=0;i<=ticks;i++){
    const x = (innerW * i / ticks);
    svg += `<line x1="${x}" y1="0" x2="${x}" y2="${innerH}" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>`;
    const v = maxV * i / ticks;
    svg += `<text x="${x}" y="${innerH+18}" fill="rgba(255,255,255,0.55)" font-size="11" text-anchor="middle">${valueFmt(v)}</text>`;
  }

  items.forEach((it, idx) => {
    const v = it[valueKey];
    const bw = innerW * (v / maxV);
    const y = idx * barH + (gap/2);
    const c = colorFor(idx);

    // bar
    svg += `<rect x="0" y="${y}" width="${bw}" height="${actualBarH}" rx="6" fill="${c}" fill-opacity="0.85">
      <title>${it[labelKey]}\n${valueKey}: ${valueFmt(v)}</title>
    </rect>`;

    // label (left)
    const label = it[labelKey];
    svg += `<text x="${-10}" y="${y + actualBarH/2 + 4}" fill="rgba(255,255,255,0.82)" font-size="12" text-anchor="end">${escapeHtml(label)}</text>`;

    // value at end
    svg += `<text x="${bw + 8}" y="${y + actualBarH/2 + 4}" fill="rgba(255,255,255,0.72)" font-size="12">${valueFmt(v)}</text>`;
  });

  svg += `</g></svg>`;
  return svg;
}

function svgPieChart(opts){
  const {title, items, valueKey, labelKey, size=320, valueFmt=(x)=>String(x), maxSlices=10} = opts;
  const w = size, h = size;
  const cx = w/2, cy = h/2;
  const r = Math.min(w,h)*0.42;
  const total = items.reduce((a,b)=>a+b[valueKey],0) || 1;

  // keep top slices, remainder as "Other"
  let top = [...items].sort((a,b)=>b[valueKey]-a[valueKey]).slice(0, maxSlices);
  const rest = items.filter(x => !top.includes(x)).reduce((a,b)=>a+b[valueKey],0);
  if (rest > 0) top.push({[labelKey]:"(other)", [valueKey]: rest});

  let ang = -Math.PI/2;
  let svg = `<svg viewBox="0 0 ${w} ${h}" width="100%" height="${h}" role="img" aria-label="${title}">
    <rect x="0" y="0" width="${w}" height="${h}" fill="transparent"/>`;

  top.forEach((it, idx) => {
    const v = it[valueKey];
    const frac = v / total;
    const sweep = frac * Math.PI * 2;
    const ang2 = ang + sweep;

    const x1 = cx + r * Math.cos(ang);
    const y1 = cy + r * Math.sin(ang);
    const x2 = cx + r * Math.cos(ang2);
    const y2 = cy + r * Math.sin(ang2);

    const large = sweep > Math.PI ? 1 : 0;
    const c = colorFor(idx);

    const d = [
      `M ${cx} ${cy}`,
      `L ${x1} ${y1}`,
      `A ${r} ${r} 0 ${large} 1 ${x2} ${y2}`,
      `Z`
    ].join(" ");

    const pct = (frac*100).toFixed(2) + "%";
    svg += `<path d="${d}" fill="${c}" fill-opacity="0.9">
      <title>${it[labelKey]}\n${valueKey}: ${valueFmt(v)}\nshare: ${pct}</title>
    </path>`;

    ang = ang2;
  });

  // donut hole
  svg += `<circle cx="${cx}" cy="${cy}" r="${r*0.55}" fill="rgba(11,15,20,0.95)" />`;
  svg += `<text x="${cx}" y="${cy-4}" fill="rgba(255,255,255,0.85)" font-size="13" text-anchor="middle">${escapeHtml(title)}</text>`;
  svg += `<text x="${cx}" y="${cy+16}" fill="rgba(255,255,255,0.65)" font-size="12" text-anchor="middle">Total: ${valueFmt(total)}</text>`;
  svg += `</svg>`;
  return {svg, top};
}

function escapeHtml(s){
  return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

function buildLegend(elId, slices, valueKey, labelKey, valueFmt){
  const el = document.getElementById(elId);
  el.innerHTML = "";
  slices.forEach((it, idx) => {
    const row = document.createElement("div");
    row.className = "legitem";
    row.innerHTML = `<span class="sw" style="background:${colorFor(idx)}"></span>
      <span class="mono">${escapeHtml(it[labelKey])}</span>
      <span style="margin-left:auto">${escapeHtml(valueFmt(it[valueKey]))}</span>`;
    el.appendChild(row);
  });
}

function renderTables(data){
  const topSize = data.top_files_by_size;
  const topLines = data.top_files_by_lines;
  const exts = data.ext_rows;

  document.getElementById("tbl_top_size").innerHTML = tableHtml(topSize, [
    ["relpath","File"],
    ["size_bytes","Size", (v)=>fmtBytes(v)],
    ["lines","Lines"],
    ["blank_lines","Blank"]
  ], "size_bytes");

  document.getElementById("tbl_top_lines").innerHTML = tableHtml(topLines, [
    ["relpath","File"],
    ["lines","Lines"],
    ["blank_lines","Blank"],
    ["size_bytes","Size", (v)=>fmtBytes(v)]
  ], "lines");

  document.getElementById("tbl_ext").innerHTML = tableHtml(exts, [
    ["ext","Ext"],
    ["files","Files"],
    ["bytes","Bytes", (v)=>fmtBytes(v)],
    ["lines","Lines"]
  ], "bytes");
}

function tableHtml(rows, cols, defaultSortKey){
  // basic sortable table
  const tid = "t_" + Math.random().toString(16).slice(2);
  const thead = cols.map(([k, name]) => `<th onclick="sortTable('${tid}','${k}')">${escapeHtml(name)}</th>`).join("");
  const body = rows.map(r => {
    const tds = cols.map(([k,_,fmt]) => {
      const v = r[k];
      const txt = fmt ? fmt(v) : String(v);
      const cls = (typeof v === "number") ? "right mono" : (k==="relpath" ? "mono" : "");
      return `<td class="${cls}" data-k="${k}" data-v="${escapeHtml(v)}">${escapeHtml(txt)}</td>`;
    }).join("");
    return `<tr>${tds}</tr>`;
  }).join("");

  // store data-sort key on table
  return `<table id="${tid}" data-sort="${defaultSortKey}" data-dir="desc">
    <thead><tr>${thead}</tr></thead>
    <tbody>${body}</tbody>
  </table>`;
}

function sortTable(tid, key){
  const tbl = document.getElementById(tid);
  const tbody = tbl.querySelector("tbody");
  const rows = Array.from(tbody.querySelectorAll("tr"));

  const curKey = tbl.getAttribute("data-sort");
  let dir = tbl.getAttribute("data-dir");
  if (curKey === key) dir = (dir === "asc") ? "desc" : "asc";
  else dir = "desc";

  rows.sort((a,b)=>{
    const av = a.querySelector(`td[data-k="${key}"]`).getAttribute("data-v");
    const bv = b.querySelector(`td[data-k="${key}"]`).getAttribute("data-v");
    const an = Number(av), bn = Number(bv);
    let cmp;
    if (!Number.isNaN(an) && !Number.isNaN(bn)) cmp = an - bn;
    else cmp = String(av).localeCompare(String(bv));
    return dir === "asc" ? cmp : -cmp;
  });

  tbody.innerHTML = "";
  rows.forEach(r => tbody.appendChild(r));

  tbl.setAttribute("data-sort", key);
  tbl.setAttribute("data-dir", dir);
}

function applyFilter(){
  const q = document.getElementById("q").value.trim().toLowerCase();
  if (!q) return;
  // Filter tables by hiding rows whose relpath does not include q
  document.querySelectorAll("table tbody tr").forEach(tr=>{
    const td = tr.querySelector('td[data-k="relpath"]');
    if (!td) return;
    const v = td.textContent.toLowerCase();
    tr.style.display = v.includes(q) ? "" : "none";
  });
}
function clearFilter(){
  document.getElementById("q").value = "";
  document.querySelectorAll("table tbody tr").forEach(tr=> tr.style.display = "");
}

function main(){
  // Charts: top files
  document.getElementById("chart_top_size").innerHTML = svgBarChart({
    title: "Top files by size",
    items: DATA.top_files_by_size,
    valueKey: "size_bytes",
    labelKey: "relpath",
    valueFmt: (v)=>fmtBytes(v),
    height: 360
  });

  document.getElementById("chart_top_lines").innerHTML = svgBarChart({
    title: "Top files by lines",
    items: DATA.top_files_by_lines,
    valueKey: "lines",
    labelKey: "relpath",
    valueFmt: (v)=>String(Math.round(v)),
    height: 360
  });

  // Pie: ext breakdown
  const pieB = svgPieChart({
    title: "Extensions • bytes",
    items: DATA.ext_rows.map(x=>({label:x.ext, value:x.bytes})),
    valueKey: "value",
    labelKey: "label",
    valueFmt: (v)=>fmtBytes(v),
    size: 340,
    maxSlices: 10
  });
  document.getElementById("pie_ext_bytes").innerHTML = pieB.svg;
  buildLegend("leg_ext_bytes", pieB.top, "value", "label", (v)=>fmtBytes(v));

  const pieL = svgPieChart({
    title: "Extensions • lines",
    items: DATA.ext_rows.map(x=>({label:x.ext, value:x.lines})),
    valueKey: "value",
    labelKey: "label",
    valueFmt: (v)=>String(Math.round(v)),
    size: 340,
    maxSlices: 10
  });
  document.getElementById("pie_ext_lines").innerHTML = pieL.svg;
  buildLegend("leg_ext_lines", pieL.top, "value", "label", (v)=>String(Math.round(v)));

  // Bars: top extensions
  const topExtBytes = [...DATA.ext_rows].sort((a,b)=>b.bytes-a.bytes).slice(0, 18).map(x=>({ext:x.ext, bytes:x.bytes}));
  document.getElementById("bar_ext_bytes").innerHTML = svgBarChart({
    title: "Top extensions by bytes",
    items: topExtBytes,
    valueKey: "bytes",
    labelKey: "ext",
    valueFmt: (v)=>fmtBytes(v),
    height: 380
  });

  const topExtLines = [...DATA.ext_rows].sort((a,b)=>b.lines-a.lines).slice(0, 18).map(x=>({ext:x.ext, lines:x.lines}));
  document.getElementById("bar_ext_lines").innerHTML = svgBarChart({
    title: "Top extensions by lines",
    items: topExtLines,
    valueKey: "lines",
    labelKey: "ext",
    valueFmt: (v)=>String(Math.round(v)),
    height: 380
  });

  renderTables(DATA);
}
main();
</script>
</body>
</html>
